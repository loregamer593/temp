<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temporizador Streamlabs</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f1f1f1;
        }
        #timer {
            font-size: 48px;
            margin: 20px;
        }
        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .btn {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        .btn:active {
            background-color: #ddd;
        }
    </style>
</head>
<body>

    <h1>Temporizador Streamlabs</h1>
    <div id="timer">01:00:00</div>
    <div class="buttons">
        <button id="start" class="btn">Iniciar</button>
        <button id="pause" class="btn">Pausar</button>
        <button id="reset" class="btn">Reiniciar</button>
        <button id="add15" class="btn">Agregar 15 min</button>
        <button id="add30" class="btn">Agregar 30 min</button>
        <button id="add60" class="btn">Agregar 60 min</button>
    </div>

    <script>
        // Temporizador
        let time = 3600; // 1 hora en segundos
        let timerInterval;
        let isRunning = false;

        function formatTime(seconds) {
            const hours = String(Math.floor(seconds / 3600)).padStart(2, '0');
            const minutes = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
            const secs = String(seconds % 60).padStart(2, '0');
            return `${hours}:${minutes}:${secs}`;
        }

        function startTimer() {
            if (isRunning) return;
            isRunning = true;
            timerInterval = setInterval(() => {
                if (time > 0) {
                    time--;
                    document.getElementById("timer").textContent = formatTime(time);
                } else {
                    clearInterval(timerInterval);
                    isRunning = false;
                }
            }, 1000);
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            isRunning = false;
        }

        function resetTimer() {
            time = 3600; // 1 hora
            document.getElementById("timer").textContent = formatTime(time);
            clearInterval(timerInterval);
            isRunning = false;
        }

        // Agregar tiempo manual
        function addTime(minutes) {
            time += minutes * 60;
            document.getElementById("timer").textContent = formatTime(time);
        }

        // Control de los botones
        document.getElementById("start").addEventListener("click", startTimer);
        document.getElementById("pause").addEventListener("click", pauseTimer);
        document.getElementById("reset").addEventListener("click", resetTimer);
        document.getElementById("add15").addEventListener("click", () => addTime(15));
        document.getElementById("add30").addEventListener("click", () => addTime(30));
        document.getElementById("add60").addEventListener("click", () => addTime(60));

        // WebSocket - Conexión a Streamlabs
        const socket = new WebSocket("wss://sockets.streamlabs.com/socket.io/?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6IjFCNDc4MUZGOUEyODY1RkRBRkE5MTY0NUE3MDJGN0U3MzhBOTRCMTA1RTMwRjRBQTI1RjI4RkQ2MzNGMjQ5MTQ4OEExMzVGQzU4OTlEMUM5ODMyMTk3MThDQjE4MkVFMDYyRjYyNUVCMDBCQzFBOTZEMDU1MDhBRDhGRjNCMjBFM0RFN0U2NEUwNEM3NTRGRjBBRDYyRDRFRkQyQkREMTQ0QzBFMEY0NDNGQ0Y2MjlGNUE1RjVFQThFREE0QkE4RDQwRjM3RkI1RjY3NEIyQjQyRkNGRDYxODdCMkM0NDJGQTM3RDY4Mzc5QTkyMkM3NjIzNTlEREM2MTMiLCJyZWFkX29ubHkiOnRydWUsInByZXZlbnRfbWFzdGVyIjp0cnVlLCJmYWNlYm9va19pZCI6IjI5NjkwMTA3MTMxNjc3MTgiLCJ5b3V0dWJlX2lkIjoiVUNLaldMZ2RXeDRncHpqeWN6QzhoM0dBIiwic3RyZWFtbGFic19pZCI6IjU0MDIyOTE2NjM4MTkyNDM1MiIsInR3aXRjaF9pZCI6Ijg0MzE1NjA3MyIsInRpa3Rva19pZCI6IjRkODQ0YzUzLTQwNzgtNWE3ZC1hNDAyLTg4ZGQ0OWMwODA0OCJ9.FU8UqPwt8a_beNbOEdRyp8qqZES1PzL4GLbuoY0JOKY");

        socket.onopen = () => {
            console.log("Conexión WebSocket exitosa.");
        };

        socket.onerror = (error) => {
            console.error("Error en la conexión WebSocket:", error);
        };

        socket.onclose = () => {
            console.log("Conexión WebSocket cerrada.");
        };

        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);

            // Donación de PayPal
            if (data.event === "donation" && data.donation.payment_type === "paypal") {
                const donationAmount = data.donation.amount;
                console.log("Donación PayPal recibida:", donationAmount);
                time += donationAmount * 60; // Cada dólar aumenta 1 minuto
                document.getElementById("timer").textContent = formatTime(time);
            }

            // Donación de Estrellas de Facebook
            if (data.event === "donation" && data.donation.payment_type === "stars") {
                const stars = data.donation.amount;
                console.log("Donación de Estrellas de Facebook:", stars);
                time += Math.floor(stars / 10) * 60; // Cada 10 estrellas agregan 1 minuto
                document.getElementById("timer").textContent = formatTime(time);
            }
        };

    </script>
</body>
</html>